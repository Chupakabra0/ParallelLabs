# Лабораторная работа №2

## Отчёт по лабораторной работе №2

по дисциплине "Параллельные и распредлённые вычисления"  
студента группы ПА-18-2  
Сафиюлина Александра Александровича

### Постановка задачи

* Установите MPICH (MPI Chameleon) крайней версии;  
* Выучить правила вызова утилиты mpiexec;  
* Скомпилировать и запустить тестовую программу с разным количеством
  процессов на одном персональном компьютере;
  
### Выполнение

#### Установка на Windows

Устанавливалась версия MPI от Microsoft по [этой ссылке][mpi-link]. Скачиваем
и запускаем обе программы. После открываем терминал и вводим команду ``mpiexec``.
Если видим такой же результат, какой указан на скриншоте ниже, то всё готово,
иначе следует добавить путь к ``mpiexec.exe`` в переменные среды Windows.

![Проверяем mpiexec на Windows][mpi-windows-check]

#### Установка на Linux

На Ubuntu/Debian и системах производных от них библиотека ставится в одну
команду:

``sudo apt-get install mpich``

После чего снова таки проверяем команду ``mpiexec --help``. Если она не выдаст
текст такой же, какой указан ниже, то внесите путь установки ``mpiexec`` в
переменные среды Linux.

![Проверяем mpiexec на Linux][mpi-linux-check]

#### Простое приложение

На языке программирования C напишем простую программу, которая будет выводить
общее количество процессов, которые запустят данное приложение и ранг (номер)
процесса.

```C
#include <stdlib.h>
#include <stdio.h>

#include "mpi.h"

int main(int argc, char** argv) {
	MPI_Init(&argc, &argv);

	int* commRank = (int*)malloc(sizeof(int));
	int* commSize = (int*)malloc(sizeof(int));

	MPI_Comm_rank(MPI_COMM_WORLD, commRank);
	MPI_Comm_size(MPI_COMM_WORLD, commSize);

	fprintf(stdout, "%s = %i\n%s = %i\n", "Comm rank", *commRank, "Comm size", *commSize);

	free(commRank);
	free(commSize);
	MPI_Finalize();

	return EXIT_SUCCESS;
}
```

Использованные функции из MPI:
* ``MPI_Init`` - инициалзация библиотеки MPI;
* ``MPI_Comm_rank`` - получает ранг (номер) текущего процесса;
* ``MPI_Comm_rank`` - получает общее количество процессов;
* ``MPI_Finalize`` - заввершение программы MPI;

Данное приложение спокойно запустится на любой операционной системе, проверим же его работу.

### Анализ результатов

#### Запуск на Windows

Строим приложение, после чего попытаемся запустить его через терминал с помощью утилиты
``mpiexec``. Укажем через флаг ``-n`` количество процессов, которые будут задействованы в
программе. Получаем следующий вывод:

![Запуск на Windows][windows-launch]

Следет отметить, что номера процессов выводятся непоследовательно, хотя могут и
наоборот.

#### Запуск на Linux

Делаем всё тоже самое, что делали на операционной системе Windows, после чего
получаем аналогичный вывод. Кроссплатформенность она такая:

![Запуск на Linux][linux-launch]

[mpi-link]: https://www.microsoft.com/en-us/download/details.aspx?id=57467

[mpi-windows-check]: img/mpi-windows-check.png
[mpi-linux-check]: img/mpi-linux-check.png
[windows-launch]: img/windows-test.png
[linux-launch]: img/
